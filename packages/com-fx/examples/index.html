<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Com-Fx 示例</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
    }
    .example {
      margin-bottom: 30px;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
    }
    .result {
      background: #f5f5f5;
      padding: 10px;
      margin-top: 10px;
      border-radius: 4px;
      font-family: monospace;
    }
    button {
      background: #007acc;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover {
      background: #005a9e;
    }
    .error {
      color: #d32f2f;
      background: #ffebee;
      padding: 10px;
      border-radius: 4px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>Com-Fx 示例</h1>

  <div class="example">
    <h2>基本函数示例</h2>
    <p>演示如何使用JSON定义创建一个简单的加法函数。</p>
    <button onclick="runBasicExample()">运行基本示例</button>
    <div id="basicResult" class="result"></div>
  </div>

  <div class="example">
    <h2>带默认参数的函数</h2>
    <p>演示如何使用默认参数。</p>
    <button onclick="runDefaultParamExample()">运行默认参数示例</button>
    <div id="defaultParamResult" class="result"></div>
  </div>

  <div class="example">
    <h2>Web Worker执行</h2>
    <p>演示在Web Worker中安全执行函数。</p>
    <button onclick="runWorkerExample()">运行Worker示例</button>
    <div id="workerResult" class="result"></div>
  </div>

  <div class="example">
    <h2>@fx装饰器示例</h2>
    <p>演示使用@fx装饰器标记的函数（需要在编译时处理）。</p>
    <button onclick="runDecoratorExample()">运行装饰器示例</button>
    <div id="decoratorResult" class="result"></div>
  </div>

  <script type="module">
    import { createFx } from '../dist/index.esm.js';

    // 基本示例：两数之和
    window.runBasicExample = async () => {
      const fx = createFx();

      const functionDefinition = {
        name: 'add',
        label: '两数之和',
        helper: '计算两个数字的和',
        parameters: [
          { name: 'a', type: 'number', label: '加数A', helper: '第一个加数' },
          { name: 'b', type: 'number', label: '加数B', helper: '第二个加数' }
        ],
        returns: {
          type: 'number',
          label: '和',
          helper: '两个数字的和'
        },
        body: `
          return arg0 + arg1;
        `
      };

      const addFunction = fx.createFunction(functionDefinition);

      try {
        const result = await addFunction(3, 5);
        document.getElementById('basicResult').innerHTML =
          `<pre>结果: ${result.result}\n执行时间: ${result.executionTime}ms\n在Worker中执行: ${result.executedInWorker}</pre>`;
      } catch (error) {
        document.getElementById('basicResult').innerHTML =
          `<div class="error">错误: ${error.message}</div>`;
      }
    };

    // 默认参数示例
    window.runDefaultParamExample = async () => {
      const fx = createFx();

      const functionDefinition = {
        name: 'greet',
        label: '问候',
        helper: '生成问候消息',
        parameters: [
          { name: 'name', type: 'string', label: '姓名', helper: '要问候的人名', default: '世界' },
          { name: 'greeting', type: 'string', label: '问候语', helper: '问候的方式', default: '你好' }
        ],
        returns: {
          type: 'string',
          label: '问候消息',
          helper: '完整的问候消息'
        },
        body: `
          return arg1 + ', ' + arg0 + '!';
        `
      };

      const greetFunction = fx.createFunction(functionDefinition);

      try {
        // 使用默认参数
        const result1 = await greetFunction();
        // 传递参数
        const result2 = await greetFunction('张三', '嗨');

        document.getElementById('defaultParamResult').innerHTML =
          `<pre>默认参数结果: "${result1.result}"\n传递参数结果: "${result2.result}"</pre>`;
      } catch (error) {
        document.getElementById('defaultParamResult').innerHTML =
          `<div class="error">错误: ${error.message}</div>`;
      }
    };

    // Web Worker示例
    window.runWorkerExample = async () => {
      const fx = createFx({ useWebWorker: true });

      const functionDefinition = {
        name: 'calculate',
        label: '计算表达式',
        helper: '计算数学表达式',
        parameters: [
          { name: 'expression', type: 'string', label: '表达式', helper: '要计算的数学表达式' }
        ],
        returns: {
          type: 'number',
          label: '结果',
          helper: '表达式的计算结果'
        },
        body: `
          // 注意：在Web Worker中，不能访问DOM等浏览器API
          // 这里简化处理，只做基本的数学运算
          if (arg0 === '2+2') return 4;
          if (arg0 === '3*4') return 12;
          return 0;
        `
      };

      const calculateFunction = fx.createFunction(functionDefinition);

      try {
        const result = await calculateFunction('2+2');
        document.getElementById('workerResult').innerHTML =
          `<pre>结果: ${result.result}\n执行时间: ${result.executionTime}ms\n在Worker中执行: ${result.executedInWorker}</pre>`;
      } catch (error) {
        document.getElementById('workerResult').innerHTML =
          `<div class="error">错误: ${error.message}</div>`;
      }
    };

    // 装饰器示例（模拟）
    window.runDecoratorExample = async () => {
      // 这里模拟一个带有@fx装饰器的函数的JSON定义
      const functionDefinition = {
        name: 'multiply',
        label: '两数之积',
        helper: '计算两个数字的乘积',
        parameters: [
          { name: 'x', type: 'number', label: '乘数X', helper: '第一个乘数' },
          { name: 'y', type: 'number', label: '乘数Y', helper: '第二个乘数' }
        ],
        returns: {
          type: 'number',
          label: '积',
          helper: '两个数字的乘积'
        },
        body: `
          return arg0 * arg1;
        `
      };

      const fx = createFx();
      const multiplyFunction = fx.createFunction(functionDefinition);

      try {
        const result = await multiplyFunction(6, 7);
        document.getElementById('decoratorResult').innerHTML =
          `<pre>结果: ${result.result}\n执行时间: ${result.executionTime}ms\n在Worker中执行: ${result.executedInWorker}</pre>`;
      } catch (error) {
        document.getElementById('decoratorResult').innerHTML =
          `<div class="error">错误: ${error.message}</div>`;
      }
    };
  </script>
</body>
</html>
